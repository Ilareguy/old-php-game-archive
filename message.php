<?php include ("includes/avant_html.php"); ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" >   <head>       <title>Berceau de Guerres - Messagerie</title>       <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />	   <link rel="stylesheet" media="screen" type="text/css" title="Design" href="design.css" />	   <link rel="shortcut icon" href="images/ico.ico" />	   <script type="Text/JavaScript" src="scripts/global.js" ></script>	   <script type="Text/JavaScript" src="scripts/bbcode.js"></script>	   <script type="Text/JavaScript" src="scripts/message.js"></script>	   <?php	   include("includes/bbcode.php");	   ?>   </head>   <body>      <?php include("includes/banniere.php"); ?>	  <div id="centre" >	  <?php	  $reponse = $bdd->prepare('SELECT * FROM messagerie WHERE id=?');	  $reponse->execute(array($_GET['id']));	  $donnees = $reponse->fetch();	  $req = $bdd->prepare('SELECT signature FROM joueurs WHERE pseudo=? ');	  $req->execute(array($donnees['destinateur']));	  $signature = $req->fetch();	  if(isset($_GET['id']) AND isset($_GET['action'])){	  switch($_GET['action']){	  	  case 'lire': //Lire un message	  if($donnees['id_destinataire'] != $_SESSION['id_joueur']){	  header('Location: index.php');	  }?>	  <h2><?php echo htmlspecialchars($donnees['titre'])?></h2>	  <?php	  if($donnees['destinateur'] == 'Votre messager')	     {echo '<p style="text-align:center" >Destinateur: Votre messager</p>';}	  else{?>	     <p style="text-align:center" >		    Destinateur: <?php echo '<a href="fiche_joueur.php?co=o&amp;pseudo='		    . htmlspecialchars($donnees['destinateur']) . '" >' . htmlspecialchars($donnees['destinateur']); ?></a>		 </p>		 <table class="table_invisible">		    <tr>			   <td>			      <a href="message.php?co=o&amp;action=rep&amp;id=<?php echo $donnees['id']; ?>">Répondre à ce message</a>			   </td>			   <td>			      <a href="messagerie.php?co=o&amp;action=sup&amp;id=<?php echo $donnees['id']; ?>&amp;type=<?php echo $donnees['type']; ?>">Supprimer ce message</a>			   </td>			</tr>		 </table>	  <?php } ?>	  <div id="div_messagerie" >	     <?php		 //Formater le texte avec le BBcode et htmlspecialchars		 $donnees['message'] = htmlspecialchars($donnees['message']);		 $donnees['message'] = bbcode($donnees['message']);		 ?>	     <p class="message"><?php echo bbcode($donnees['message']); ?></p>	     <p class="signature_message"><strong><?php echo $signature['signature'];?></strong></p>	     <p class="date_message"><?php echo $donnees['date']; ?></p>	  </div>	  <?php $bdd->exec('UPDATE messagerie SET message_lu = \'1\' WHERE id=' . $_GET['id'] . '');	  break;	  	  case 'ecrire': //Écrire un nouveau message	  ?>	  <h2>Rédiger une nouvelle lettre</h2>	  	  <table class="table_invisible" >	     <tr>		    <td>	           <form action="messagerie.php?co=o&amp;action=env&amp;id=0&amp;type=0" method="post" name="formulaire_message"> <!-- Peu importe l'id ici -->	           <label>À qui cette lettre doit-elle se rendre?<br />	           <?php if(isset($_GET['destinataire']))	           {			      ?>	              <input onChange="verifierDestinataire(this.value)" name="destinataire" maxlength="25" style="width: 185px;" value="<?php echo $_GET['destinataire']; ?>" />			      <?php	           }	           else	           {			      ?>	              <input onChange="verifierDestinataire(this.value.length)" name="destinataire" maxlength="25" style="width: 185px;"/>			      <?php	           }?>	           <br /><br /></label>	  	           <label>Quel titre donnez-vous à votre lettre?<br />	           <input onChange="verifierTitre(this.value.length)" name="titre" maxlength="30" style="width: 200px;" ></input>	           <br /><br /></label>			</td>			<td style="width:30%;background-color:#9fa040" rowspan="2" >			   <?php include("includes/formatage_texte.php"); ?>			</td>		 </tr>	     <tr>		    <td>	           <label>Inscrivez votre message<br />	           <textarea name="message_textarea" rows="10" cols="50"></textarea>	           <br /><br /></label>			</td>		 </tr>		 <tr>		    <td colspan="2" >			<p id="statut_formulaire_destinataire">N'oubliez pas d'entrer un pseudo !</p>			<p id="statut_formulaire_titre">N'oubliez pas d'entrer un titre !</p>	           <input type="submit" name="boutonEnvoyer" value="Envoyer le messager"/>	           </form>			</td>		 </tr>	  </table>	  <?php break;	  	  case 'rep':	  $reponse = $bdd->prepare('SELECT * FROM messagerie WHERE id=?');	  $reponse->execute(array($_GET['id']));	  $donnees = $reponse->fetch();	  ?>	  <h2>Rédiger une nouvelle lettre</h2>	  	  <table class="table_invisible">	     <tr>		    <td>	           <form action="messagerie.php?co=o&amp;action=env&amp;id=0&amp;type=0" method="post" name="formulaire_message"> <!-- Peu importe l'id ici -->	  	           <label>À qui cette lettre doit-elle se rendre?<br />	           <input onChange="verifierDestinataire(this.value.length)" name="destinataire" maxlength="25" style="width: 185px;" 	           <?php echo'value="' . htmlspecialchars($donnees['destinateur']) . '"'; ?>></input>	           <br /><br /></label>	  	           <label>Quel titre donnez-vous à votre lettre?<br />	           <input onChange="verifierTitre(this.value.length)" name="titre" for="titre"  maxlength="50" style="width: 200px;" 	           <?php echo 'value="' . htmlspecialchars($donnees['titre']) . '"'; ?>></input>	           <br /><br /></label>	        </td>			<td style="width:30%;background-color:#9fa040" rowspan="2" >			   <?php include("includes/formatage_texte.php"); ?>			</td>		 </tr>		 <tr>		    <td>	           <label>Inscrivez votre message<br />	           <textarea name="message_textarea" rows="10" cols="50"></textarea>	           <br /><br /></label>	        </td>		 </tr>		 <tr>		    <td colspan="2">			   <p id="statut_formulaire_destinataire">N'oubliez pas d'entrer un pseudo !</p>			   <p id="statut_formulaire_titre">N'oubliez pas d'entrer un titre !</p>	           <input type="submit" name="boutonEnvoyer" value="Envoyer le messager" style="margin-bottom: 40px;" ></input>			</td>		 </tr>	     </form>	  </table>	  <?php break;	  }	  }	  ?>	  </div>	  <?php include("includes/menu_jeu.php"); ?>	  <?php include("includes/pied_de_page.php"); ?>	</body></html>